<!DOCTYPE HTML>
<html>
<head>
<title>Wines</title>
<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all">
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<!-- Custom Theme files -->
<link href="css/style.css" rel="stylesheet" type="text/css" media="all"/>
<link rel="stylesheet" href="css/flexslider.css" type="text/css" media="screen" />
<link rel="stylesheet" href="css/swipebox.css">
<link rel="stylesheet" href="css/button.css">
<script src="js/echarts.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); }
</script>
<meta name="keywords" content="" />
<link href="css/font-awesome.min.css" rel="stylesheet" type="text/css" media="all" />
<script type="text/javascript" src="js/move-top.js"></script>
<script type="text/javascript" src="js/easing.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.js"></script>
<script type="text/javascript" src="js/jquery-1.4.1.js"></script>
<link rel="stylesheet" href="css/stock_style.css" />
<script type="text/javascript" src="js/d3.js"></script> 


<script type="text/javascript">

	function goBack(){
		window.history.back(-1); 
		location.reload(); 
	}
	var stockCode="600804";
	var show = new Array();//存储当前股票价格
	var time = new Array();//show对应的时间
	var show2 = new Array();//存储当天的开盘价
	var startPrice;
	var judge1 = true;
	var uid = 600804;
	var userId;
	var sname;
	var myModalLabelText;
	var NowPrice;
	var xAxis = new Array();
	var priceData = new Array();
	var nowAssets;
	var beforeAssets;
	
			jQuery(document).ready(function($) {
				function getUrlParam(name) {
					  var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
					  var r = window.location.search.substr(1).match(reg); //匹配目标参数
					  if (r != null) return unescape(r[2]); return null; //返回参数值
				}
				function getAssets()
			     {
			    	 $.ajax({
					    	url:"usert/dynamicProfile.action",
						    method: "GET",
						    async: false,
						    data: {
						    	"uid": userId
						    },   
						    
						    success:function(data){
						    	
						    	nowAssets = data.uasset.toFixed(2);
						    },
						    error:function(){
							     alert("error");
							
						    }
					    });
			     }
				
				 uid = getUrlParam("uid");
				 var name1 = "<li id= 'name1'class='active' style = 'font-size:20px'>" + uid + "</li>";
				 document.getElementById('name1').innerText = uid;
				 var temp = "<p style = 'text-align:center; font-size:30px'>股票号： " + uid +"</p>";
				    $("#strockId").append(temp);//显示股票号
				    
				    $.ajax({
				    	url:"usert/getSession.action",
					    method: "GET",
					    success:function(data){
						     if(data.uid!= null)
						    	 {
						    	 userId = data.uid;
						    	 }
						     console.log(userId);
						     
					    },
					    error:function(){
					    	
						     alert("error!");
						
					    }
				    });   
				    
				 getNewData();
				 getRealTimeData();
			     var tg=self.setInterval("getNewData()",2000);//N毫秒刷新一次，1000毫秒＝1秒,每隔2秒获取运行一次getNewData函数
			     var tg1=self.setInterval("getRealTimeData()",60000);
			     $(".scroll").click(function(event){		
					event.preventDefault();
					$('html,body').animate({scrollTop:$(this.hash).offset().top},1000);
				});
			     
			     
			     echartDailyK();
			     echartWeeklyK();
			     echartMonthlyK();
			     columeChart();
			     
			     
			     $("#subscribe").click(function(){
			    	 if(userId!= null)
			    		 {
			    		 $.ajax({
						    	url:"usert/addSubscribe.action",
							    method: "POST",
							    data: {"sid": uid,
							    	"uid": userId,
							    	"sname":sname,
							    },   
							    dataType: "text",
							    success:function(data){
								     if(data == 1)
								    	 {
								    	 alert("成功关注");
								    	 }
								     else if (data == 0)
								    	 {
								    	 alert("您已经关注");
								    	 }
								     
							    },
							    error:function(){
								     alert("error");
								
							    }
						    });
			    		
			    		 }
						
			    	 else 
	    			 {
	    			 alert("请登录");
	    			 }
					});
			     
			     
			     
			     $("#buyThisStock").click(function(){
						var numberOfStock = $("#numberOfStock").val();
						//alert(numberOfStock);
						if(numberOfStock !=null  && parseInt(numberOfStock) >= 0)
							{
							
							$.ajax({
						    	url:"usert/buyStock.action",
							    method: "POST",
							    data: {"sid": uid,
							    	"uid": userId,
							    	"number":numberOfStock,
							    	"sname":sname,
							    	"nowPrice": NowPrice
							    },   
							    dataType: "text",
							    success:function(data){
								     if(data == 1)
								    	 {
								    	 
								    	 getAssets();
								    	 beforeAssets = parseFloat(nowAssets) + parseFloat(numberOfStock*NowPrice);
								    	 beforeAssets = beforeAssets.toFixed(2);
								    	 $("#inner1").empty();
								    	 var add1 = "<p style=' text-align:center;font-size:20px'>成功购买:" + sname + "</p>";
								    	 var add2 = "<p style=' text-align:center;font-size:20px'>购买数量: "+ numberOfStock + "</p>";
								    	 var add3 = "<p style=' text-align:center;font-size:20px'>购买价格 :"+ NowPrice + "</p>";
								    	 var add4 = "<p style=' text-align:center;font-size:20px'>资产变化 :"+ beforeAssets + "-->" +nowAssets + "</p>";
								    	 var replace1 = "<button id='complete' onclick='reload1()' type='button' class='btn btn-primary'>"+"完成"+"</button>";
								    	 $("#inner1").append(add1);
								    	 $("#inner1").append(add2);
								    	 $("#inner1").append(add3);
								    	 $("#inner1").append(add4);
								    	 $("#buyThisStock").replaceWith(replace1);
								    	
								    	 
								    	 }
								     if(data == 2)
								    	 {
								    	 alert("余额不够");
								    	 }
								     
							    },
							    error:function(){
								     alert("请输入正确的金额");
								
							    }
						    });
							}
						else
						{
						alert("请输入正确的股票数");
						}
						
					});
			     
			     
			     
			     
			     $("#sellThisStock").click(function(){
						var numberOfStock = $("#numberOfStock1").val();
						
						if(numberOfStock!= null && parseInt(numberOfStock) >= 0 )
							{
							
							$.ajax({
						    	url:"usert/sellStock.action",
							    method: "POST",
							    data: {"sid": uid,
							    	"uid": userId,
							    	"number":numberOfStock,
							    	"sname":sname,
							    	"nowPrice": NowPrice
							    },   
							    dataType: "text",
							    success:function(data){
								     if(data == 1)
								    	 {
								    	 getAssets();
								    	 beforeAssets = parseFloat(nowAssets) - parseFloat(numberOfStock*NowPrice);
								    	 beforeAssets = beforeAssets.toFixed(2);
								    	 $("#inner2").empty();
								    	 var add1 = "<p style=' text-align:center;font-size:20px'>成功卖出:" + sname + "</p>";
								    	 var add2 = "<p style=' text-align:center;font-size:20px'>卖出数量: "+ numberOfStock + "</p>";
								    	 var add3 = "<p style=' text-align:center;font-size:20px'>卖出价格 :"+ NowPrice + "</p>";
								    	 var add4 = "<p style=' text-align:center;font-size:20px'>资产变化 :"+ beforeAssets + "-->" +nowAssets + "</p>";
								    	 var replace1 = "<button id='complete1' onclick='reload1()' type='button' class='btn btn-primary'>"+"完成"+"</button>";
								    	 $("#inner2").append(add1);
								    	 $("#inner2").append(add2);
								    	 $("#inner2").append(add3);
								    	 $("#inner2").append(add4);
								    	 $("#sellThisStock").replaceWith(replace1);
								    	 }
								     if(data == 2)
								    	 {
								    	 alert("您未持有当前股票");
								    	 }
								     if(data == 3)
								    	 {
								    	 alert("您不持有足够的股票");
								    	 }
								     
							    },
							    error:function(){
								     alert("请输入正确的数量");
								
							    }
						    });
							}
						else
							{
							alert("请输入正确的股票数");
							}
						
						
					});
			     
			});
			
			
			 function getRealTimeData()
			 {
				 xAxis.splice(0,xAxis.length);
				 priceData.splice(0,priceData.length);
				 
				 
				 var durl = "http://route.showapi.com/131-49?showapi_appid=40765&showapi_sign=8ac00aa3f88f450bbbf21ad8b300ff64&code=" + uid + "&day=1&";
				 $.getJSON(durl,function(data){
					 console.log(data.showapi_res_body.dataList[0].minuteList);
					 console.log(data.showapi_res_body.dataList[0].minuteList.length);
					 xAxis.push("开盘时间");
					 for (var i = 0; i < data.showapi_res_body.dataList[0].minuteList.length - 2; i ++)
						 {
						 priceData.push(data.showapi_res_body.dataList[0].minuteList[i].avgPrice);
						 xAxis.push("");
						 }
					 xAxis.push("当前时间");
					 console.log(xAxis);
					 console.log('1',priceData);
					 realTimeChart(xAxis,priceData);
					 
				 })
				 
			 }
			
			 function getNewData()
			{
				var state = 1;
			    var durl="http://hq.sinajs.cn/list=sh"; //网址接口
			    durl = durl + uid;
			    $.getScript(durl,function(data){ //将网站的内容作为script文件，不建议这么做 ajax的内容
			    	var a = eval("hq_str_sh" + uid);
			        var temp = a.split(","); //将string分开，用","分割
			        startPrice = temp[1];//开盘价
			        NowPrice = temp[3];
			        myModalLabelText = "股票：" + uid +sname+ ",当前价格：" + NowPrice;
			        document.getElementById('myModalLabel1').innerText = myModalLabelText;
			        
			        document.getElementById('myModalLabel2').innerText = myModalLabelText;
				     
				     
			        
			        var NowPrice1 = "<p id ='NowPrice' style = 'text-align:center; opacity:0' >当前价格： " + NowPrice  +"  </p>";
			        var StartPrice1 = "<p id ='NowPrice' style = 'text-align:center' >开盘价： " + startPrice  +"  </p>";
			        sname = temp[0];
			        var sid1 = "<a class='bets-name' id = 'sid1' >" + sname + "(<span>" + uid + "</span>) </a>";
			        $("#sid1").html(sid1);
			        var tempDate = getNowFormatDate();
			        var s2 ="<span class='state f-up' id = 's2'>" + tempDate +  "</span>";
			        $("#s2").html(s2);
			        var s3 = "<strong id = 's3' >" +  NowPrice  +"</strong>";
			        $("#s3").html(s3);
			        var maxPrice = temp[4];
			        if(maxPrice == 0 )
			        	{
			        	state = 0;//未开盘状态
			        	maxPrice ="未开盘";
			        	}
			        //var s4 = "<dd id = 's4' >" + maxPrice  + "</dd>";
			        $("#s4").html(maxPrice);
			        var minPrice = temp[5];
			        if(minPrice == 0 )
		        	{
		        	minPrice ="未开盘";
		        	}
			        var s5 = "<dd id = 's5' >" + minPrice  + "</dd>";
			        $("#s5").html(s5);
			        var closePrice = temp[2];
			        var s7 = "<dd id = 's7' >" + closePrice  + "</dd>";
			        $("#s7").html(s7);
			        var openPrice = temp[1];
			        if(openPrice == 0)
		        	{
		        	openPrice = "未开盘";
		        	}
			        var s6 = "<dd id = 's6' >" + openPrice  + "</dd>"; 
			        $("#s6").html(s6);
			        
			        var total1 = temp[9];
			        total1 = total1/10000;
			        total1 = total1.toFixed(2);
			        if(state == 0)
			        	{
			        	total1 = "未开盘";
			        	}
			        var s8 = "<dd id = 's8' >" + total1  + "万</dd>";
			        $("#s8").html(s8);
			        var total2 = temp[8];
			        total2 = total2/100;
			        total2 = total2.toFixed(2);
			        if(state == 0)
		        	{
		        	total2 = "未开盘";
		        	}
			        var s9 = "<dd id = 's9' >" + total2  + "手</dd>";
			        $("#s9").html(s9);
			        var priceChange = NowPrice - closePrice;
			        priceChange = priceChange.toFixed(3);
			        if(state == 0)
		        	{
		        	priceChange = "未开盘";
		        	}
			        var priceChangeRate = priceChange / closePrice * 100;
			        priceChangeRate = priceChangeRate.toFixed(3);
			        if(state == 0)
		        	{
		        	priceChangeRate = "未开盘";
		        	}
			        var PN;
			        if(priceChange > 0)
			        	{
			        	PN = "+";
			        	}
			        else if(priceChange < 0)
			        	{
			        	PN = "";
			        	}
			        else{
			        	PN ="";
			        }
			        var s10 = " <span id = 'priceChange'>" + PN +priceChange + "</span>";
			        var s11 = " <span id = 'priceChangeRate'>" + PN +priceChangeRate + "%</span>";
			        $("#priceChange").html(s10);
			        $("#priceChangeRate").html(s11);
			        if(priceChange > 0)
		        	{
		        	$("#s3").css("color","red");
		        	//$("#s4").css("color","red");
		        	//$("#s5").css("color","red");
		        	
		        	$("#priceChange").css("color","red");
		        	$("#priceChangeRate").css("color","red");
		        	}
		        else if(priceChange < 0)
		        	{
		        	$("#s3").css("color","#00AA00");
		        	//$("#s4").css("color","#00AA00");
		        	//$("#s5").css("color","#00AA00");
		        	
		        	$("#priceChange").css("color","#00AA00");
		        	$("#priceChangeRate").css("color","#00AA00");
		        	}
		        else{
		        	PN ="";
		        }
			        $("#StartPrice").replaceWith(StartPrice1);
			        $("#NowPrice").replaceWith(NowPrice1);
			        
			        
			        $("#NowPrice").animate({
			         
			            opacity:'1'
			            
			          });
			        
			        for(var i = 0; i< 20; i++)
			        {
			        	show2.push(startPrice);
			        }
			        if(show.length < 20 && show.length != 0)
			        {
			        	var a = 20 - show.length ;
			        	for(var i = 0; i < a; i++)
			        	{
			        		time.pop();
			        	}
			        	time.push(temp[31]);
			        	for(var i = 0; i < a - 1; i ++)
			        	{
			        	time.push("");
			        	}
			        	show.push(temp[3]);//在数组后添加
			        } 
			        if(show.length == 20)
			        {
			        	show.shift();
			        	time.shift();
			        	show.push(temp[3]);//在数组后添加
			        	time.push(temp[31]);
			        }
			        if(show.length == 0)
			        {
			        	show.push(temp[3]);
			        	time.push(temp[31]);
			        	for(var i = 0; i < 19; i++)
			        	{
			        		time.push("");
			        	}
			        }
			        //show.push(temp[3]);
			        
			        //console.log(time);
			        
			        //console.log(show);
			        
			        drawCharts();
			    });
			   
			}
			//刷新显示
           
			
			
			function getNowFormatDate() {
    		var date = new Date();
    		var seperator1 = "-";
    		var seperator2 = ":";
    		var month = date.getMonth() + 1;
    		var strDate = date.getDate();
    		if (month >= 1 && month <= 9) {
        		month = "0" + month;
    		}
    		if (strDate >= 0 && strDate <= 9) {
        		strDate = "0" + strDate;
    		}
    		var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
          		  + " " + date.getHours() + seperator2 + date.getMinutes()
            		+ seperator2 + date.getSeconds();
    		return currentdate;
			}
			
			 
			function drawCharts(){
				var lineChartData = {
			    labels : time,
			    datasets : [
			        {
			            label: "当前价格",
			            fillColor : "rgba(151,187,205,0.5)",
			            strokeColor : "rgba(1 ,6,6,1)",
			            pointColor : "blue",
			            pointStrokeColor : "black",
			            pointHighlightFill : "#fff",
			            pointHighlightStroke : "rgba(220,220,220,1)",
			            data : []
			        },
			        /*{
			        	label: "开盘价",
			        	fillColor : 'white',
			            strokeColor : "white",
			            pointColor : 'black',
			            pointStrokeColor : 'white',
			            pointHighlightFill : "white",
			            pointHighlightStroke : "white",
			            data : show2
			        	
			        }*/
			    ]
			}
				
			for(var i = 0; i < show.length;i++)
			   { 
			    lineChartData.datasets[0].data.push(show[i]);
			    //console.log(lineChartData.datasets[0].data);//将数组show中的值写入data
			   }
			   
			    $("#containor1").empty();
			    $("#containor1").append("<canvas id='myChart' style='width: 800px;height:600px'></canvas>");
			    
			    var ctx = document.getElementById("myChart").getContext("2d");
			        var mychart = window.myLine = new Chart(ctx, {
			        	
			                                        type:'line',
			                                        data: lineChartData,
			                                        
			                                        options:{
			                                        	
			                                        	animation: {
			        												duration: 1,
			       	 												onComplete: function () {
			            						var chartInstance = this.chart,
			            						ctx = chartInstance.ctx;
			            						ctx.textAlign = 'center';
			            						ctx.textBaseline = 'bottom';

			            						this.data.datasets.forEach(function (dataset, i) {
			            
			                
			                					var meta = chartInstance.controller.getDatasetMeta(i);
			                					meta.data.forEach(function (bar, index) {
			                   					 var data = dataset.data[index];
			                   					 if(data > startPrice)
			                    					{
			                    						ctx.fillStyle = 'red';
			                    					}
			                 					 if(data < startPrice)
			                 						{
			                 						ctx.fillStyle = 'green';
			                 						}
			                 					 if(data == startPrice)
			                 						{
			                 						ctx.fillStyle = 'black';
			                 						}
			                    
			                 						ctx.fillText(data, bar._model.x, bar._model.y - 5);
			                    
			                    
			                });
			            });
			                                        	
			                                                }
			                                        
			                                        }}
			                                        
			                                  });
			                                  mychart.clear();
			}
			
			function echartDailyK(){
				
				var myChart = echarts.init(document.getElementById('main'));
				var csvName = "csvFiles/" + uid + ".csv";
				d3.csv(csvName,function(rawData1){
					var rawData2=[];
					for(var i = 0; i < rawData1.length;i ++)
						{
						rawData2[i] = [rawData1[i].date, rawData1[i].open, rawData1[i].close, rawData1[i].low,rawData1[i].high];
						}
					rawData2 = rawData2.reverse();
					//console.log(rawData2);
				     function calculateMA(dayCount, data) {
				         var result = [];
				         for (var i = 0, len = data.length; i < len; i++) {
				             if (i < dayCount) {
				                 result.push('-');
				                 continue;
				             }
				             var sum = 0;
				             for (var j = 0; j < dayCount; j++) {
				                 sum += data[i - j][1];
				             }
				             result.push((sum / dayCount).toFixed(4));
				         }
				         return result;
				     }


				     var dates = rawData2.map(function (item) {
				         return item[0];
				     });
				     //console.log(dates);

				     var data = rawData2.map(function (item) {
				         //return [+item[1], +item[2], +item[3], +item[4]];
				         return [+item[1], +item[2], +item[3], +item[4]];
				     });
				     var option = {
				         backgroundColor: 'white',
				         legend: {
				             data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30'],
				             inactiveColor: '#777',
				             textStyle: {
				                 color: 'black'
				             }
				         },
				         tooltip: {
				             trigger: 'axis',
				             axisPointer: {
				                 animation: true,
				                 type: 'cross',
				                 lineStyle: {
				                     color: '#376df4',
				                     width: 2,
				                     opacity: 1
				                 }
				             }
				         },
				         xAxis: {
				             type: 'category',
				             data: dates,
				             axisLine: { lineStyle: { color: 'balck' } }
				         },
				         yAxis: {
				             scale: true,
				             axisLine: { lineStyle: { color: 'black' } },
				             splitLine: { show: false }
				         },
				         grid: {
				             bottom: 80
				         },
				         dataZoom: [{
				             textStyle: {
				                 color: '#8392A5'
				             },
				             handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
				             handleSize: '80%',
				             dataBackground: {
				                 areaStyle: {
				                     color: '#8392A5'
				                 },
				                 lineStyle: {
				                     opacity: 0.8,
				                     color: '#8392A5'
				                 }
				             },
				             handleStyle: {
				                 color: '#fff',
				                 shadowBlur: 3,
				                 shadowColor: 'rgba(0, 0, 0, 0.6)',
				                 shadowOffsetX: 2,
				                 shadowOffsetY: 2
				             }
				         }, {
				             type: 'inside'
				         }],
				         animation: false,
				         series: [
				             {
				                 type: 'candlestick',
				                 name: '日K',
				                 data: data,
				                 itemStyle: {
				                     normal: {
				                         color: '#FD1050',
				                         color0: '#0CF49B',
				                         borderColor: '#FD1050',
				                         borderColor0: '#0CF49B'
				                     }
				                 }
				             },
				             {
				                 name: 'MA5',
				                 type: 'line',
				                 data: calculateMA(5, data),
				                 smooth: true,
				                 showSymbol: false,
				                 lineStyle: {
				                     normal: {
				                         width: 1
				                     }
				                 }
				             },
				             {
				                 name: 'MA10',
				                 type: 'line',
				                 data: calculateMA(10, data),
				                 smooth: true,
				                 showSymbol: false,
				                 lineStyle: {
				                     normal: {
				                         width: 1
				                     }
				                 }
				             },
				             {
				                 name: 'MA20',
				                 type: 'line',
				                 data: calculateMA(20, data),
				                 smooth: true,
				                 showSymbol: false,
				                 lineStyle: {
				                     normal: {
				                         width: 1
				                     }
				                 }
				             },
				             {
				                 name: 'MA30',
				                 type: 'line',
				                 data: calculateMA(30, data),
				                 smooth: true,
				                 showSymbol: false,
				                 lineStyle: {
				                     normal: {
				                         width: 1
				                     }
				                 }
				             }
				         ]
				     };
				     myChart.setOption(option);                            });

				


			             // 使用刚指定的配置项和数据显示图表。
			             
			}

			 //以上为实时价格图
			 
		        // 以下为周k线
		        function echartWeeklyK(){
				
				var myChart = echarts.init(document.getElementById('main1'));
				var csvName = "csvFiles/" + uid + "weekly.csv";
				d3.csv(csvName,function(rawData1){
					var rawData2=[];
					for(var i = 0; i < rawData1.length;i ++)
						{
						rawData2[i] = [rawData1[i].date, rawData1[i].open, rawData1[i].close, rawData1[i].low,rawData1[i].high];
						}
					rawData2 = rawData2.reverse();
					//console.log(rawData2);
				     function calculateMA(dayCount, data) {
				         var result = [];
				         for (var i = 0, len = data.length; i < len; i++) {
				             if (i < dayCount) {
				                 result.push('-');
				                 continue;
				             }
				             var sum = 0;
				             for (var j = 0; j < dayCount; j++) {
				                 sum += data[i - j][1];
				             }
				             result.push((sum / dayCount).toFixed(4));
				         }
				         return result;
				     }


				     var dates = rawData2.map(function (item) {
				         return item[0];
				     });
				     //console.log(dates);

				     var data = rawData2.map(function (item) {
				         //return [+item[1], +item[2], +item[3], +item[4]];
				         return [+item[1], +item[2], +item[3], +item[4]];
				     });
				     var option = {
				         backgroundColor: 'white',
				         legend: {
				             data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30'],
				             inactiveColor: '#777',
				             textStyle: {
				                 color: 'black'
				             }
				         },
				         tooltip: {
				             trigger: 'axis',
				             axisPointer: {
				                 animation: true,
				                 type: 'cross',
				                 lineStyle: {
				                     color: '#376df4',
				                     width: 2,
				                     opacity: 1
				                 }
				             }
				         },
				         xAxis: {
				             type: 'category',
				             data: dates,
				             axisLine: { lineStyle: { color: 'balck' } }
				         },
				         yAxis: {
				             scale: true,
				             axisLine: { lineStyle: { color: 'black' } },
				             splitLine: { show: false }
				         },
				         grid: {
				             bottom: 80
				         },
				         dataZoom: [{
				             textStyle: {
				                 color: '#8392A5'
				             },
				             handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
				             handleSize: '80%',
				             dataBackground: {
				                 areaStyle: {
				                     color: '#8392A5'
				                 },
				                 lineStyle: {
				                     opacity: 0.8,
				                     color: '#8392A5'
				                 }
				             },
				             handleStyle: {
				                 color: '#fff',
				                 shadowBlur: 3,
				                 shadowColor: 'rgba(0, 0, 0, 0.6)',
				                 shadowOffsetX: 2,
				                 shadowOffsetY: 2
				             }
				         }, {
				             type: 'inside'
				         }],
				         animation: false,
				         series: [
				             {
				                 type: 'candlestick',
				                 name: '周K',
				                 data: data,
				                 itemStyle: {
				                     normal: {
				                         color: '#FD1050',
				                         color0: '#0CF49B',
				                         borderColor: '#FD1050',
				                         borderColor0: '#0CF49B'
				                     }
				                 }
				             },
				             {
				                 name: 'MA5',
				                 type: 'line',
				                 data: calculateMA(5, data),
				                 smooth: true,
				                 showSymbol: false,
				                 lineStyle: {
				                     normal: {
				                         width: 1
				                     }
				                 }
				             },
				             {
				                 name: 'MA10',
				                 type: 'line',
				                 data: calculateMA(10, data),
				                 smooth: true,
				                 showSymbol: false,
				                 lineStyle: {
				                     normal: {
				                         width: 1
				                     }
				                 }
				             },
				             {
				                 name: 'MA20',
				                 type: 'line',
				                 data: calculateMA(20, data),
				                 smooth: true,
				                 showSymbol: false,
				                 lineStyle: {
				                     normal: {
				                         width: 1
				                     }
				                 }
				             },
				             {
				                 name: 'MA30',
				                 type: 'line',
				                 data: calculateMA(30, data),
				                 smooth: true,
				                 showSymbol: false,
				                 lineStyle: {
				                     normal: {
				                         width: 1
				                     }
				                 }
				             }
				         ]
				     };
				     myChart.setOption(option);                            });

				


			             // 使用刚指定的配置项和数据显示图表。
			             
			}
			 
		        function echartMonthlyK(){
					
					var myChart = echarts.init(document.getElementById('main2'));
					var csvName = "csvFiles/" + uid + "monthly.csv";
					d3.csv(csvName,function(rawData1){
						var rawData2=[];
						for(var i = 0; i < rawData1.length;i ++)
							{
							rawData2[i] = [rawData1[i].date, rawData1[i].open, rawData1[i].close, rawData1[i].low,rawData1[i].high];
							}
						rawData2 = rawData2.reverse();
						//console.log(rawData2);
					     function calculateMA(dayCount, data) {
					         var result = [];
					         for (var i = 0, len = data.length; i < len; i++) {
					             if (i < dayCount) {
					                 result.push('-');
					                 continue;
					             }
					             var sum = 0;
					             for (var j = 0; j < dayCount; j++) {
					                 sum += data[i - j][1];
					             }
					             result.push((sum / dayCount).toFixed(4));
					         }
					         return result;
					     }


					     var dates = rawData2.map(function (item) {
					         return item[0];
					     });
					     

					     var data = rawData2.map(function (item) {
					         //return [+item[1], +item[2], +item[3], +item[4]];
					         return [+item[1], +item[2], +item[3], +item[4]];
					     });
					     var option = {
					         backgroundColor: 'white',
					         legend: {
					             data: ['日K', 'MA5', 'MA10', 'MA20', 'MA30'],
					             inactiveColor: '#777',
					             textStyle: {
					                 color: 'black'
					             }
					         },
					         tooltip: {
					             trigger: 'axis',
					             axisPointer: {
					                 animation: true,
					                 type: 'cross',
					                 lineStyle: {
					                     color: '#376df4',
					                     width: 2,
					                     opacity: 1
					                 }
					             }
					         },
					         xAxis: {
					             type: 'category',
					             data: dates,
					             axisLine: { lineStyle: { color: 'balck' } }
					         },
					         yAxis: {
					             scale: true,
					             axisLine: { lineStyle: { color: 'black' } },
					             splitLine: { show: false }
					         },
					         grid: {
					             bottom: 80
					         },
					         dataZoom: [{
					             textStyle: {
					                 color: '#8392A5'
					             },
					             handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
					             handleSize: '80%',
					             dataBackground: {
					                 areaStyle: {
					                     color: '#8392A5'
					                 },
					                 lineStyle: {
					                     opacity: 0.8,
					                     color: '#8392A5'
					                 }
					             },
					             handleStyle: {
					                 color: '#fff',
					                 shadowBlur: 3,
					                 shadowColor: 'rgba(0, 0, 0, 0.6)',
					                 shadowOffsetX: 2,
					                 shadowOffsetY: 2
					             }
					         }, {
					             type: 'inside'
					         }],
					         animation: false,
					         series: [
					             {
					                 type: 'candlestick',
					                 
					                 data: data,
					                 itemStyle: {
					                     normal: {
					                         color: '#FD1050',
					                         color0: '#0CF49B',
					                         borderColor: '#FD1050',
					                         borderColor0: '#0CF49B'
					                     }
					                 }
					             },
					             {
					                 name: 'MA5',
					                 type: 'line',
					                 data: calculateMA(5, data),
					                 smooth: true,
					                 showSymbol: false,
					                 lineStyle: {
					                     normal: {
					                         width: 1
					                     }
					                 }
					             },
					             {
					                 name: 'MA10',
					                 type: 'line',
					                 data: calculateMA(10, data),
					                 smooth: true,
					                 showSymbol: false,
					                 lineStyle: {
					                     normal: {
					                         width: 1
					                     }
					                 }
					             },
					             {
					                 name: 'MA20',
					                 type: 'line',
					                 data: calculateMA(20, data),
					                 smooth: true,
					                 showSymbol: false,
					                 lineStyle: {
					                     normal: {
					                         width: 1
					                     }
					                 }
					             },
					             {
					                 name: 'MA30',
					                 type: 'line',
					                 data: calculateMA(30, data),
					                 smooth: true,
					                 showSymbol: false,
					                 lineStyle: {
					                     normal: {
					                         width: 1
					                     }
					                 }
					             }
					         ]
					     };
					     myChart.setOption(option);                            });

					


				             // 使用刚指定的配置项和数据显示图表。
				             
				}
		        function reload1(){ 
			    	 
			    	 window.location.reload();
			    	 };
			    	 
                    function columeChart(){
					var arg1 = [];
					var arg2 = [];
					var myChart = echarts.init(document.getElementById('main3'));
					var csvName = "csvFiles/" + uid + "statistic.csv";
					d3.csv(csvName,function(rawData1){
						//console.log(rawData1);
						for (var i = 0; i < rawData1.length; i ++)
							{
							  arg1.push (rawData1[i].volume/10000);
							  arg2.push(rawData1[i].price_change);
							}
						//console.log(arg1);
						//console.log(arg2);
						
						

						var colors = ['#5793f3', '#d14a61'];

						option = {
								itle: {
							        x: 'center',
							        text: '统计数据',
							        subtext: 'Rainbow bar example',
							        link: 'http://echarts.baidu.com/doc/example.html'
							    },
						
						    color: colors,

						    tooltip: {
						        trigger: 'axis',
						        axisPointer: {
						            type: 'cross'
						        }
						    },
						    grid: {
						        right: '20%'
						    },
						    toolbox: {
						        feature: {
						            
						        }
						    },
						    legend: {
						        data:['交易额','价格变化']
						    },
						    xAxis: [
						        {
						            type: 'category',
						            axisTick: {
						                alignWithLabel: true
						            },
						            data: ['11月前','10月前','9月前','8月前','7月前','6月前','5月前','4月前','3月前','2月前','1月前','当前月']
						        }
						    ],
						    yAxis: [
						        {
						            type: 'value',
						            name: '交易额',
						            min: 0,
						            max: 1000,
						            position: 'right',
						            axisLine: {
						                lineStyle: {
						                    color: colors[0]
						                }
						            },
						            axisLabel: {
						                formatter: '{value} 万'
						            }
						        },
						        
						        {
						            type: 'value',
						            name: '价格变化',
						            min: -10,
						            max: 10,
						            position: 'left',
						            axisLine: {
						                lineStyle: {
						                    color: colors[1]
						                }
						            },
						            axisLabel: {
						                formatter: '{value} 元'
						            }
						        }
						    ],
						    series: [
						        {
						            name:'交易额',
						            type:'bar',
						            data:arg1
						        },
						        
						        {
						            name:'价格变化',
						            type:'line',
						            yAxisIndex: 1,
						            data:arg2
						        }
						    ]
						};
							                    
					     myChart.setOption(option);                            });

					


				             // 使用刚指定的配置项和数据显示图表。
				             
				}
                    
                    function realTimeChart(){
                    	option = {
                    		    
                    		    tooltip : {
                    		        trigger: 'axis'
                    		    },
                    		    legend: {
                    		        data:['价格']
                    		    },
                    		    
                    		    calculable : true,
                    		    xAxis : [
                    		        {
                    		            type : 'category',
                    		            boundaryGap : false,
                    		            data : xAxis,
                    		        }
                    		    ],
                    		    yAxis : [
                    		        {
                    		            scale:true,
                    		        	type : 'value',
                    		            axisLabel : {
                    		                formatter: '{value} 元'
                    		            }
                    		        }
                    		    ],
                    		    series : [
                    		        {
                    		            name:'价格',
                    		            type:'line',
                    		            data:priceData,
                    		            markPoint : {
                    		                data : [
                    		                    {type : 'max', name: '最大值'},
                    		                    {type : 'min', name: '最小值'}
                    		                ]
                    		            },
                    		            markLine : {
                    		                data : [
                    		                    {type : 'average', name: '平均值'}
                    		                ]
                    		            }
                    		        },
                    		        
                    		    ]
                    		};
                    		                    
                    		                    
    					var myChart = echarts.init(document.getElementById('main4'));
    					
    					    							                    
    					     myChart.setOption(option);                            

    					


    				             // 使用刚指定的配置项和数据显示图表。
    				             
    				}
                    
                    
	
	</script>
	
<!-- //end-smoth-scrolling -->
</head>
<body>
<button id = "goBack" onclick="self.location=document.referrer;" class="button button-large button-plain button-border button-circle" style= "background: #229ffd; position: relative; left: 10px" ><i class="fa fa-reply"></i></button>
<div class="stock-info" data-spm="2">
    
    
    
    
    <div class="stock-bets">
        <h1>
            <a class="bets-name" id = "sid1" href="/stock/sh000001.html">
            上证指数 (<span>000001</span>)
            </a>
            <span class="state f-up" id = "s2">未开盘 2017-05-31 &nbsp;09:50:14
            </span>
        </h1>
        <div class="price s-up ">
                        <strong id = "s3" class="_close">3139.15</strong>
            <span id = "priceChange">+29.09</span>
            <span id = "priceChangeRate">+0.94%</span>
                    </div>
        <div class="bets-content">
            
                            <div class="bets-col-9">
                <dl><dt>最高</dt><dd id = "s4" class="s-up"style = "color:black">3139.40</dd></dl>
                <dl><dt>最低</dt><dd id = "s5" class="s-up"style = "color:black">3120.59</dd></dl>
                <dl><dt>今开</dt><dd id = "s6" class="s-up" style = "color:black">3125.33</dd></dl>
                <dl><dt>昨收</dt><dd id = "s7">3110.06</dd></dl>

                                    <dl><dt >成交额</dt><dd id = "s8">402.80亿</dd></dl>
                    <dl><dt>成交量</dt><dd id = "s9">3382.45万手</dd></dl>
                                
                 
                    
                                </div>
                        <div class="clear"></div>
        </div>
    </div>




    <ul class="stock-add" style="position:absolute; left:1133px">
        <li data-spm="1"><button id = "subscribe" class="">+ 加自选</button></li>
        
    </ul>
    <ul class="stock-add" style="position:absolute; left:1320px">
        <li data-spm="1"><button class="" data-toggle="modal" data-target="#buyStock">$ 买入</button></li>
        
    </ul>
    <ul class="stock-add">
        <li data-spm="1"><button class="" data-toggle="modal" data-target="#sellStock">$ 卖出</button></li>
        
    </ul>
    </div>
    
<div id = "strockId">
</div>

<p id = "NowPrice"></p>
<p id = "StartPrice"></p>




<div id="main" style="width: 800px;height:400px;"></div>
<div id = "containor1"style="width: 800px;height:600px;position:absolute;left:850px;top:300px">
<canvas id="myChart" style="width: 800px;height:600px"></canvas>
</div>
<div id="main1" style="width: 800px;height:400px;"></div>
<div id="main2" style="width: 800px;height:400px; positon:relative; left:800px; top: -400px"></div>
<div id="main4" style="width: 1400px;height:400px;position:relative; top: -370px; left:120px"></div>
<div id="main3" style="width: 1600px;height:400px; position:relative; top: -370px; left:100px"></div>

  <div class="button-group" style = "position : absolute; top: 250px; left : 190px; ">
    <button type="button" class="button button-pill button-action">日k线</button>
    <button type="button" class="button button-pill button-action">周k线</button>
    <button type="button" class="button button-pill button-action">月k线</button>
  </div>  
  <button class="button button-highlight button-circle button-large" style= "position:absolute; left:120px; top:320px">日k</button>
  <button class="button button-highlight button-circle button-large" style= "position:absolute; left:920px; top:320px">实时</button>
  <button class="button button-highlight button-circle button-large" style= "position:absolute; left:120px; top:720px">周k</button>
  <button class="button button-highlight button-circle button-large" style= "position:absolute; left:920px; top:720px">月k</button>
  <button class="button button-highlight button-circle button-large" style= "position:absolute; left:320px; top:1120px">分时线</button>
  <button class="button button-highlight button-circle button-large" style= "position:absolute; left:320px; top:1520px">统计</button>
  <ul class="breadcrumb" style = "position:absolute; left:80px; top:5px;background-color:rgba(0,0,0,0)">
							<li>
							    
								<a href="http://localhost:8088/ssf/index.html" style = "font-size:20px;color :#428bca">首页</a>
							</li>
							<li>
							    
								<a href="http://localhost:8088/ssf/stockList.html" style = "font-size:20px;color :#428bca">查询</a>
							</li>
							<li id= "name1"class="active" style = "font-size:20px">详情</li>
						</ul>
<!-- 模态框（Modal） -->
<div class="modal fade" id="buyStock" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"  data-backdrop="static">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" 
						aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel1" style = "text-align:center;">
					购买股票
				</h4>
			</div>
			<div class="modal-body">
				<p id = "inner1">
           			<label for="login" style = "font-size : 15px; position:relative; left:100px">购买数量：(股)</label>
      				<input type="text" name="uid" id="numberOfStock" class = 'RegesterForm' style= "margin:10px;position:relative; left:100px">
    			</p>
    			
			</div>
			<div class="modal-footer">
				
				<button id = "buyThisStock" type="button" class="btn btn-primary">
					购买
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- 模态框（Modal） -->
<div class="modal fade" id="sellStock" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"  data-backdrop="static">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" 
						aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel2" style = "text-align:center;">
					卖出股票
				</h4>
			</div>
			<div class="modal-body">
				<p id = "inner2">
           			<label for="login" style = "font-size : 15px;position:relative; left:100px">卖出数量：(股)</label>
      				<input type="text" name="uid" id="numberOfStock1" class = 'RegesterForm' style= "margin:10px;position:relative; left:100px">
    			</p>
    			
			</div>
			<div class="modal-footer">
				
				<button id = "sellThisStock" type="button" class="btn btn-primary">
					卖出
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
</body>
</html>